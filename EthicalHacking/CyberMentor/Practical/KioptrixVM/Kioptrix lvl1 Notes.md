80/443 is open
Apache/1.3.20 (Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b
Default webpage - Apache - PHP
Information disclosure - 404 page
![[Kioptrix404InfoDisclojure.png]]

Information disclosure - server headers disclose version information

`nikto -h 192.168.1.101`
```
mod_ssl/2.8.4 - mod_ssl 2.8.7 and lower are vulnerable to a remote buffer overflow which may allow a remote shell. http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2002-0082, OSVDB-756.
```

http://192.168.1.101/usage/usage_200909.html - probably also info disclosure in footer
Generated by **Webalizer Version 2.01**

`msfconsole` - to open metasploit
auxiliary modules in it is basicly for enumeration
you can search in it with
`search smb`
for module enabling
`use auxiliary/scanner/smb/smb_version`
use `info` to get information about enabled module
use `options` to get information about module options
`set RHOSTS 192.168.1.101` - to set module RHOSTS option
RHOST stands for Remote Host and LHOST stands for Local Host
`run` for running module

after this we have info about exact samba version
**Unix (Samba 2.2.1a)**

we can try to look at samba files
`smbclient -L \\\\192.168.1.101\\` -L stands for list
we get next result
```
Sharename       Type      Comment
        ---------       ----      -------
        IPC$            IPC       IPC Service (Samba Server)
        ADMIN$          IPC       IPC Service (Samba Server)
```
we can try to connect to those via
`smbclient \\\\192.168.1.101\\ADMIN$`

another info from nmap was
`22/tcp    open  ssh         OpenSSH 2.9p2 (protocol 1.99)`
we can try to connect there
`ssh 192.168.1.101`
and will get error
```
Unable to negotiate with 192.168.1.101 port 22: no matching key exchange method found. Their offer: diffie-hellman-group-exchange-sha1,diffie-hellman-group1-sha1
```

it can be fixed by choosing one of given key exchange methods
`ssh 192.168.1.101 -oKexAlgorithms=+diffie-hellman-group1-sha1`
and then there will be one more error
```
Unable to negotiate with 192.168.1.101 port 22: no matching host key type found. Their offer: ssh-rsa,ssh-dss
```
fixing this by adding another option
`ssh 192.168.1.101 -oKexAlgorithms=+diffie-hellman-group1-sha1 -oHostKeyAlgorithms=+ssh-dss`
and get error again
```
Unable to negotiate with 192.168.1.101 port 22: no matching cipher found. Their offer: aes128-cbc,3des-cbc,blowfish-cbc,cast128-cbc,arcfour,aes192-cbc,aes256-cbc,rijndael128-cbc,rijndael192-cbc,rijndael256-cbc,rijndael-cbc@lysator.liu.se
```
we need to specify cypher now and we will be able to connect, but we don't have password
`ssh 192.168.1.101 -oKexAlgorithms=+diffie-hellman-group1-sha1 -oHostKeyAlgorithms=+ssh-dss -c aes128-cbc`
so we doing this to see if connection banner can give us some info like ssh version if nmap wasn't able to get ssh version

there is better way to fix this in note [[SSH client fix script]]

next step is googling for version of software with "explot" addition, or using something like
`searchsploit Samba 2.2.1a`
